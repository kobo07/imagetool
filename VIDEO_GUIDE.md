# 视频处理工具使用指南

## 功能概述

视频处理工具提供了强大的视频编辑和压缩功能，所有处理都在浏览器本地完成，无需上传到服务器。

## 主要功能

### 1. 视频格式转换
支持以下格式之间的相互转换：
- **MP4** (推荐) - 兼容性最好
- **WebM** - 现代Web格式
- **AVI** - 传统格式
- **MOV** - Apple格式
- **MKV** - 高质量容器

### 2. 视频裁剪
- 设置开始时间和结束时间
- 精确到0.1秒
- 实时预览裁剪效果

### 3. 压缩模式

#### 质量优先模式
- 使用CRF (Constant Rate Factor) 控制质量
- CRF值范围: 18-35
  - **18**: 高质量，文件较大
  - **23**: 推荐值，质量与大小平衡
  - **35**: 低质量，文件最小
- 适合对画质有要求的场景

#### 目标大小模式 ⭐
这是本工具的特色功能！
- 输入目标文件大小（如50MB）
- 系统自动计算最佳比特率
- 尽可能接近目标大小
- 公式: `bitrate = (target_size * 8192) / duration - audio_bitrate`

**使用场景：**
- 需要上传到有大小限制的平台
- 控制存储空间
- 邮件附件大小限制

#### 平衡模式
- 使用默认的CRF 23
- 适合大多数场景

### 4. 分辨率调整
提供常用分辨率预设：
- **1920×1080** (1080p) - 全高清
- **1280×720** (720p) - 高清
- **854×480** (480p) - 标清
- **640×360** (360p) - 低清
- **自定义** - 输入任意分辨率

### 5. 实时预览
- 上传后立即预览视频
- 显示详细信息：文件名、大小、时长、分辨率
- 处理完成后对比原始和处理后的参数

### 6. 处理进度显示
- 实时进度条
- FFmpeg处理日志
- 详细状态信息

## 使用步骤

### 基础使用
1. 点击"选择视频"或拖拽视频文件到上传区域
2. 预览视频并查看信息
3. 选择输出格式（默认MP4）
4. 选择压缩模式
5. 点击"开始处理"
6. 等待处理完成
7. 预览处理结果
8. 点击"下载视频"保存

### 目标大小压制示例

**场景：将一个200MB的视频压制到50MB左右**

1. 上传视频
2. 输出格式选择 **MP4**
3. 压缩模式选择 **目标大小**
4. 输入目标大小：**50** MB
5. （可选）调整分辨率以获得更好的质量
6. 点击"开始处理"

系统会自动计算合适的比特率，使最终文件接近50MB。

**提示：**
- 如果原视频时长较长，可能需要降低分辨率才能达到目标大小
- 建议目标大小不要设置得太小，否则画质会严重下降
- 音频比特率固定为128kbps

### 裁剪视频示例

**场景：只保留视频的10秒到30秒部分**

1. 上传视频
2. 勾选"裁剪视频长度"
3. 开始时间输入：**10**
4. 结束时间输入：**30**
5. 选择其他设置
6. 点击"开始处理"

### 压缩大视频示例

**场景：将4K视频压缩为1080p并减小文件大小**

1. 上传4K视频
2. 勾选"调整分辨率"
3. 选择 **1920×1080**
4. 压缩模式选择 **质量优先**
5. 质量滑块调整到 **28** (适度压缩)
6. 点击"开始处理"

## 技术说明

### FFmpeg.wasm
- 使用WebAssembly版本的FFmpeg
- 首次使用时需要加载约30MB的核心文件
- 加载后会缓存，后续使用更快
- 完全在浏览器中运行，无需服务器

### 性能考虑
- **处理时间**：取决于视频大小和复杂度
  - 小视频（<100MB）：1-3分钟
  - 中等视频（100-500MB）：3-10分钟
  - 大视频（>500MB）：10分钟以上
- **内存占用**：处理大文件需要较多内存
- **浏览器要求**：需要支持WebAssembly的现代浏览器

### 比特率计算原理

目标大小模式使用以下公式：

```
视频比特率 = (目标大小KB × 8) / 视频时长秒 - 音频比特率
```

例如：
- 目标大小：50MB = 51200KB
- 视频时长：60秒
- 音频比特率：128kbps

```
视频比特率 = (51200 × 8) / 60 - 128
           = 6826.67 - 128
           = 6698.67 kbps
```

系统会使用这个比特率进行编码，最终文件大小会非常接近50MB。

## 常见问题

### Q: 为什么首次使用很慢？
A: 首次需要下载FFmpeg核心文件（约30MB），之后会缓存。

### Q: 支持哪些视频格式？
A: 几乎所有常见格式：MP4, AVI, MOV, MKV, WebM, FLV, WMV等。

### Q: 处理后的视频质量如何？
A: 使用H.264编码器，质量取决于CRF值或目标大小设置。

### Q: 可以处理多大的视频？
A: 理论上无限制，但建议不超过1GB，否则可能导致浏览器卡顿。

### Q: 目标大小模式准确吗？
A: 通常误差在±5%以内，取决于视频内容复杂度。

### Q: 数据安全吗？
A: 完全安全！所有处理都在你的浏览器本地完成，文件不会上传到任何服务器。

## 浏览器兼容性

- ✅ Chrome 87+
- ✅ Edge 87+
- ✅ Firefox 89+
- ✅ Safari 15+
- ❌ IE (不支持)

## 最佳实践

1. **目标大小设置**：建议不低于原文件的20%
2. **分辨率调整**：降低分辨率可显著减小文件大小
3. **裁剪优先**：先裁剪再压缩，可节省处理时间
4. **质量测试**：首次使用建议先用小文件测试效果
5. **保存原文件**：处理前建议备份原始视频

## 技术栈

- **FFmpeg.wasm** - 视频处理引擎
- **HTML5 Video API** - 视频预览
- **Web Workers** - 后台处理（未来优化）
- **原生JavaScript** - 无框架依赖

---

享受强大的本地视频处理体验！🎬
